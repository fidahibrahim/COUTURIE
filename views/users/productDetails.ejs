<%-include('../layout/user/header.ejs') %>
    <style>
        .product-main-image {
            position: relative;
            overflow: hidden;
        }

        .product-main-image img {
            transition: transform 0.1s ease;
            transform-origin: center center;
        }
    </style>
    <div class="page-wrapper">
        <header class="header">
            <div class="header-top">
                <div class="container">
                    <div class="header-left">
                        <div class="header-dropdown">
                            <a href="#">Usd</a>
                            <div class="header-menu">
                                <ul>
                                    <li><a href="#">Eur</a></li>
                                    <li><a href="#">Usd</a></li>
                                </ul>
                            </div><!-- End .header-menu -->
                        </div><!-- End .header-dropdown -->

                        <div class="header-dropdown">
                            <a href="#">Eng</a>
                            <div class="header-menu">
                                <ul>
                                    <li><a href="#">English</a></li>
                                    <li><a href="#">French</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </div><!-- End .header-menu -->
                        </div><!-- End .header-dropdown -->
                    </div><!-- End .header-left -->

                    <div class="header-right">
                        <ul class="top-menu">
                            <li>
                                <a href="#">Links</a>
                                <ul>
                                    <li><a href="tel:#"><i class="icon-phone"></i>Call: +0123 456 789</a></li>

                                    <li><a href="/login"><i class="icon-user"></i>Login</a></li>
                                </ul>
                            </li>
                        </ul><!-- End .top-menu -->
                    </div><!-- End .header-right -->
                </div><!-- End .container -->
            </div><!-- End .header-top -->

            <div class="header-middle sticky-header">
                <div class="container">
                    <div class="header-left">
                        <button class="mobile-menu-toggler">
                            <span class="sr-only">Toggle mobile menu</span>
                            <i class="icon-bars"></i>
                        </button>

                        <a href="index.html" class="logo">
                            <img src="assets/images/logo.png" alt="Molla Logo" width="105" height="25">
                        </a>

                        <nav class="main-nav">
                            <ul class="menu sf-arrows">
                                <li>
                                    <a href="/" class="sf-ul">Home</a>
                                </li>
                                <li class="megamenu-container active">
                                    <a href="/shop" class="sf-ul">Shop</a>
                                </li>
                                <li>
                                    <a href="/about" class="sf-ul">About</a>
                                </li>
                                <li>
                                    <a href="/contact" class="sf-ul">Contact</a>
                                </li>
                                <li>
                                    <a href="#" class="sf-ul">
                                        <%= locals.user ? user.username :"Profile" %>
                                    </a>
                                </li>
                            </ul><!-- End .menu -->
                        </nav><!-- End .main-nav -->
                    </div><!-- End .header-left -->

                    <div class="header-right">
                        <div class="header-search">
                            <a href="#" class="search-toggle" role="button" title="Search"><i
                                    class="icon-search"></i></a>
                            <form action="#" method="get">
                                <div class="header-search-wrapper">
                                    <label for="q" class="sr-only">Search</label>
                                    <input type="search" class="form-control" name="q" id="q" placeholder="Search in..."
                                        required>
                                </div><!-- End .header-search-wrapper -->
                            </form>
                        </div><!-- End .header-search -->
                        <div class="dropdown compare-dropdown">
                            <a href="/wishlist" class="dropdown-toggle" role="button" aria-haspopup="true"
                                aria-expanded="false"  title="Compare Products"
                                aria-label="Compare Products">
                                <i class="icon-heart-o"></i>
                            </a>


                        </div><!-- End .compare-dropdown -->

                        <div class="dropdown cart-dropdown">
                            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false" >
                                <i class="icon-shopping-cart"></i>
                                <span class="cart-count">2</span>
                            </a>


                        </div><!-- End .cart-dropdown -->
                    </div><!-- End .header-right -->
                </div><!-- End .container -->
            </div><!-- End .header-middle -->
        </header><!-- End .header -->

        <main class="main">
            <nav aria-label="breadcrumb" class="breadcrumb-nav border-0 mb-0">
                <div class="container d-flex align-items-center">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item"><a href="/shop">shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Product Details</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content">
                <div class="container">
                    <div class="product-details-top mb-2">
                        <div class="row">

                            <div class="col-md-6">
                                <div class="product-gallery">
                                    <figure class="product-main-image" id="product-main-image">
                                        <img src="/assets/images/productImg/sharpedImg/<%= product.images[0] %>"
                                            alt="product image" id="main-product-image">
                                        <a href="#" id="btn-product-gallery" class="btn-product-gallery">
                                            <i class="icon-arrows"></i>
                                        </a>
                                    </figure>
                                    <input type="hidden" id="productId" value="<%= product._id%>">

                                    <div id="product-zoom-gallery" class="product-image-gallery">
                                        <a class="product-gallery-item" href="#"
                                            onclick="changeProductImage('<%= product.images[0] %>')">
                                            <img src="/assets/images/productImg/sharpedImg/<%= product.images[0] %>"
                                                alt="product side">
                                        </a>

                                        <a class="product-gallery-item" href="#"
                                            onclick="changeProductImage('<%= product.images[1] %>')">
                                            <img src="/assets/images/productImg/sharpedImg/<%= product.images[1] %>"
                                                alt="product cross">
                                        </a>

                                        <a class="product-gallery-item active" href="#"
                                            onclick="changeProductImage('<%= product.images[2] %>')">
                                            <img src="/assets/images/productImg/sharpedImg/<%= product.images[2] %>"
                                                alt="product with model">
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="product-details">
                                    <h1 class="product-title">
                                        <%= product.name %>
                                    </h1>
                                    <div class="ratings-container">
                                        <div class="ratings">
                                            <div class="ratings-val" style="width: 80%;"></div>
                                        </div>
                                        <a class="ratings-text" href="#" id="review-link">
                                            ( 2 Reviews )</a>
                                    </div>

                                    <% if(product.appliedOffer){ %>
                                        <span style="margin-right: 74%;" class="badge badge-danger" ><%= product.offerText%></span>
                                        <div class="product-price" style="display: block;">
                                            <div style="display: inline; text-decoration: line-through; color: rgba(156, 156, 156, 0.696);">
                                                ₹<%= product.price %>
                                            </div> &nbsp;
                                            <div style="display: inline;"> 
                                                ₹<%= product.discountedPrice %>
                                            </div>
                                        </div>
                                        
                                        <% }else{ %>
                                            <div class="product-price">
                                                ₹ <%= product.price %>
                                            </div>
                                            <% } %>
                                    <div class="product-content">
                                        <p>
                                            <%= product.description%>
                                        </p>
                                    </div>
                                    <div class="details-filter-row details-row-size">
                                        <label for="qty">Qty:</label>
                                        <div class="product-details-quantity">
                                            <input type="text" id="quantity" class="form-control" value="1" min="1"
                                                max="10" step="1" data-decimals="0" readonly>
                                        </div>
                                    </div>
                                    <div class="product-details-action">
                                        <a href="#" class="btn-product btn-cart" onclick="addToCart()"><span>add to
                                                cart</span></a>
                                        <div class="details-action-wrapper">
                                            <a href="#" class="btn-product btn-wishlist"
                                                onclick="addToWishlist('<%= product._id%>')"><span>Add to
                                                    Wishlist</span></a>
                                        </div><!-- End .details-action-wrapper -->
                                    </div><!-- End .product-details-action -->
                                </div><!-- End .product-details-footer -->
                            </div><!-- End .product-details -->
                        </div><!-- End .col-md-6 -->
                    </div><!-- End .row -->
                </div><!-- End .product-details-top -->
            </div><!-- End .container -->

            <div class="product-details-tab product-details-extended">
                <div class="container">
                    <ul class="nav nav-pills justify-content-center" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="product-desc-link" data-toggle="tab" href="#product-desc-tab"
                                role="tab" aria-controls="product-desc-tab" aria-selected="true">Description</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="product-info-link" data-toggle="tab" href="#product-info-tab"
                                role="tab" aria-controls="product-info-tab" aria-selected="false">Additional
                                information</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="product-shipping-link" data-toggle="tab"
                                href="#product-shipping-tab" role="tab" aria-controls="product-shipping-tab"
                                aria-selected="false">Shipping & Returns</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="product-review-link" data-toggle="tab" href="#product-review-tab"
                                role="tab" aria-controls="product-review-tab" aria-selected="false">Reviews (2)</a>
                        </li>
                    </ul>
                </div><!-- End .container -->

                <div class="tab-content">
                    <div class="tab-pane fade show active" id="product-desc-tab" role="tabpanel"
                        aria-labelledby="product-desc-link">
                        <div class="product-desc-content">
                            <div class="product-desc-row bg-image"
                                style="background-image: url('/assets/images/productImg/sharpedImg/<%= product.images[0] %>')">
                                <div class="container">
                                    <div class="row justify-content-end">
                                        <div class="col-sm-6 col-lg-4">
                                            <h2>Product Information</h2>
                                            <ul>
                                                <li>Faux suede fabric upper</li>
                                                <li>Tie strap buckle detail</li>
                                                <li>Block heel</li>
                                                <li>Open toe</li>
                                                <li>Heel Height: 7cm / 2.5 inches</li>
                                            </ul>
                                        </div><!-- End .col-lg-4 -->
                                    </div><!-- End .row -->
                                </div><!-- End .container -->
                            </div><!-- End .product-desc-row -->

                            <div class="product-desc-row bg-image text-white"
                                style="background-image: url('assets/images/products/single/extended/bg-2.jpg')">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h2>Design</h2>
                                            <p>The perfect choice for the summer months. These wedges are perfect
                                                for holidays and home, with the thick cross-over strap design and
                                                heel strap with an adjustable buckle fastening. Featuring chunky
                                                soles with an espadrille and cork-style wedge. </p>
                                        </div><!-- End .col-md-6 -->

                                        <div class="col-md-6">
                                            <h2>Fabric & care</h2>
                                            <p>As part of our Forever Comfort collection, these wedges have ultimate
                                                cushioning with soft padding and flexi soles. Perfect for strolls
                                                into the old town on holiday or a casual wander into the village.
                                            </p>
                                        </div><!-- End .col-md-6 -->
                                    </div><!-- End .row -->

                                    <div class="mb-5"></div><!-- End .mb-3 -->

                                    <img src="assets/images/products/single/extended/sign.png" alt=""
                                        class="ml-auto mr-auto">
                                </div><!-- End .container -->
                            </div><!-- End .product-desc-row -->

                            <div class="product-desc-row bg-image"
                                style="background-image: url('assets/images/products/single/extended/bg-3.jpg')">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-lg-5">
                                            <blockquote>
                                                <p>“ Everything is important - <br>that success is in the details. ”
                                                </p>

                                                <cite>– Steve Jobs</cite>
                                            </blockquote>
                                            <p>Nullam mollis. Ut justo. Suspendisse potenti. Sed egestas, ante et
                                                vulputate volutpat, eros pede semper est, vitae luctus metus libero
                                                eu augue. </p>
                                        </div><!-- End .col-lg-5 -->
                                    </div><!-- End .row -->
                                </div><!-- End .container -->
                            </div><!-- End .product-desc-row -->
                        </div><!-- End .product-desc-content -->
                    </div><!-- .End .tab-pane -->
                    <div class="tab-pane fade" id="product-info-tab" role="tabpanel"
                        aria-labelledby="product-info-link">
                        <div class="product-desc-content">
                            <div class="container">
                                <h3>Information</h3>
                                <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque
                                    volutpat mattis eros. Nullam malesuada erat ut turpis. Suspendisse urna viverra
                                    non, semper suscipit, posuere a, pede. Donec nec justo eget felis facilisis
                                    fermentum. Aliquam porttitor mauris sit amet orci. </p>

                                <h3>Fabric & care</h3>
                                <ul>
                                    <li>Faux suede fabric</li>
                                    <li>Gold tone metal hoop handles.</li>
                                    <li>RI branding</li>
                                    <li>Snake print trim interior </li>
                                    <li>Adjustable cross body strap</li>
                                    <li> Height: 31cm; Width: 32cm; Depth: 12cm; Handle Drop: 61cm</li>
                                </ul>

                                <h3>Size</h3>
                                <p>one size</p>
                            </div><!-- End .container -->
                        </div><!-- End .product-desc-content -->
                    </div><!-- .End .tab-pane -->
                    <div class="tab-pane fade" id="product-shipping-tab" role="tabpanel"
                        aria-labelledby="product-shipping-link">
                        <div class="product-desc-content">
                            <div class="container">
                                <h3>Delivery & returns</h3>
                                <p>We deliver to over 100 countries around the world. For full details of the
                                    delivery options we offer, please view our <a href="#">Delivery
                                        information</a><br>
                                    We hope you’ll love every purchase, but if you ever need to return an item you
                                    can do so within a month of receipt. For full details of how to make a return,
                                    please view our <a href="#">Returns information</a></p>
                            </div><!-- End .container -->
                        </div><!-- End .product-desc-content -->
                    </div><!-- .End .tab-pane -->
                    <div class="tab-pane fade" id="product-review-tab" role="tabpanel"
                        aria-labelledby="product-review-link">
                        <div class="reviews">
                            <div class="container">
                                <h3>Reviews (2)</h3>
                                <div class="review">
                                    <div class="row no-gutters">
                                        <div class="col-auto">
                                            <h4><a href="#">Samanta J.</a></h4>
                                            <div class="ratings-container">
                                                <div class="ratings">
                                                    <div class="ratings-val" style="width: 80%;"></div>
                                                    <!-- End .ratings-val -->
                                                </div><!-- End .ratings -->
                                            </div><!-- End .rating-container -->
                                            <span class="review-date">6 days ago</span>
                                        </div><!-- End .col -->
                                        <div class="col">
                                            <h4>Good, perfect size</h4>

                                            <div class="review-content">
                                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ducimus
                                                    cum dolores assumenda asperiores facilis porro reprehenderit
                                                    animi culpa atque blanditiis commodi perspiciatis doloremque,
                                                    possimus, explicabo, autem fugit beatae quae voluptas!</p>
                                            </div><!-- End .review-content -->

                                            <div class="review-action">
                                                <a href="#"><i class="icon-thumbs-up"></i>Helpful (2)</a>
                                                <a href="#"><i class="icon-thumbs-down"></i>Unhelpful (0)</a>
                                            </div><!-- End .review-action -->
                                        </div><!-- End .col-auto -->
                                    </div><!-- End .row -->
                                </div><!-- End .review -->

                                <div class="review">
                                    <div class="row no-gutters">
                                        <div class="col-auto">
                                            <h4><a href="#">John Doe</a></h4>
                                            <div class="ratings-container">
                                                <div class="ratings">
                                                    <div class="ratings-val" style="width: 100%;"></div>
                                                    <!-- End .ratings-val -->
                                                </div><!-- End .ratings -->
                                            </div><!-- End .rating-container -->
                                            <span class="review-date">5 days ago</span>
                                        </div><!-- End .col -->
                                        <div class="col">
                                            <h4>Very good</h4>

                                            <div class="review-content">
                                                <p>Sed, molestias, tempore? Ex dolor esse iure hic veniam laborum
                                                    blanditiis laudantium iste amet. Cum non voluptate eos enim, ab
                                                    cumque nam, modi, quas iure illum repellendus, blanditiis
                                                    perspiciatis beatae!</p>
                                            </div><!-- End .review-content -->

                                            <div class="review-action">
                                                <a href="#"><i class="icon-thumbs-up"></i>Helpful (0)</a>
                                                <a href="#"><i class="icon-thumbs-down"></i>Unhelpful (0)</a>
                                            </div><!-- End .review-action -->
                                        </div><!-- End .col-auto -->
                                    </div><!-- End .row -->
                                </div><!-- End .review -->
                            </div><!-- End .container -->
                        </div><!-- End .reviews -->
                    </div><!-- .End .tab-pane -->
                </div><!-- End .tab-content -->
            </div><!-- End .product-details-tab -->


    </div><!-- End .page-content -->
    </main><!-- End .main -->

    <footer class="footer">
        <div class="footer-middle">
            <div class="container">
                <div class="row">
                    <div class="col-sm-6 col-lg-3">
                        <div class="widget widget-about">
                            <img src="assets/images/logo.png" class="footer-logo" alt="Footer Logo" width="105"
                                height="25">
                            <p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu vulputate
                                magna eros eu erat. </p>

                            <div class="social-icons">
                                <a href="#" class="social-icon" target="_blank" title="Facebook"><i
                                        class="icon-facebook-f"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Twitter"><i
                                        class="icon-twitter"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Instagram"><i
                                        class="icon-instagram"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Youtube"><i
                                        class="icon-youtube"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Pinterest"><i
                                        class="icon-pinterest"></i></a>
                            </div><!-- End .soial-icons -->
                        </div><!-- End .widget about-widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Useful Links</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="/about">About Molla</a></li>
                                <li><a href="/shop">How to shop on Molla</a></li>
                                <li><a href="#">FAQ</a></li>
                                <li><a href="/contact">Contact us</a></li>
                                <li><a href="/login">Log in</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Customer Service</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="#">Payment Methods</a></li>
                                <li><a href="#">Money-back guarantee!</a></li>
                                <li><a href="#">Returns</a></li>
                                <li><a href="#">Shipping</a></li>
                                <li><a href="#">Terms and conditions</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">My Account</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="/register">Sign In</a></li>
                                <li><a href="cart.html">View Cart</a></li>
                                <li><a href="#">My Wishlist</a></li>
                                <li><a href="#">Track My Order</a></li>
                                <li><a href="#">Help</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->
                </div><!-- End .row -->
            </div><!-- End .container -->
        </div><!-- End .footer-middle -->

        <div class="footer-bottom">
            <div class="container">
                <p class="footer-copyright">Copyright © 2019 Molla Store. All Rights Reserved.</p>
                <!-- End .footer-copyright -->
                <figure class="footer-payments">
                    <img src="assets/images/payments.png" alt="Payment methods" width="272" height="20">
                </figure><!-- End .footer-payments -->
            </div><!-- End .container -->
        </div><!-- End .footer-bottom -->
    </footer><!-- End .footer -->
    </div><!-- End .page-wrapper -->
    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

    <!-- Mobile Menu -->
    <div class="mobile-menu-overlay"></div><!-- End .mobil-menu-overlay -->

    <div class="mobile-menu-container">
        <div class="mobile-menu-wrapper">
            <span class="mobile-menu-close"><i class="icon-close"></i></span>

            <form action="#" method="get" class="mobile-search">
                <label for="mobile-search" class="sr-only">Search</label>
                <input type="search" class="form-control" name="mobile-search" id="mobile-search"
                    placeholder="Search in..." required>
                <button class="btn btn-primary" type="submit"><i class="icon-search"></i></button>
            </form>

            <nav class="mobile-nav">
                <ul class="mobile-menu">
                    <li class="active">
                        <a href="/home">Home</a>
                    </li>
                    <li>
                        <a href="/shop">Shop</a>
                    </li>
                    <li>
                        <a href="/product" class="sf-with-ul">Product</a>
                    </li>
                    <li>
                        <a href="/about">about</a>
                    </li>
                    <li>
                        <a href="/contact">contact</a>
                    </li>
                    <li>
                        <a href="#">profile</a>
                    </li>
                </ul>
            </nav><!-- End .mobile-nav -->

            <div class="social-icons">
                <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
            </div><!-- End .social-icons -->
        </div><!-- End .mobile-menu-wrapper -->
    </div><!-- End .mobile-menu-container -->





    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let image = document.querySelector('.product-main-image img');
            let container = document.getElementById('product-main-image');

            container.addEventListener('mousemove', function (e) {
                let rect = container.getBoundingClientRect();
                let x = e.clientX - rect.left;
                let y = e.clientY - rect.top;
                let centerX = rect.width / 2;
                let centerY = rect.height / 2;
                let offsetX = (centerX - x) / centerX;
                let offsetY = (centerY - y) / centerY;
                let scaleFactor = 1.6;
                let translateFactor = 8;
                let transformValue = 'scale(' + scaleFactor + ') translate(' + (offsetX * translateFactor) + 'px, ' + (offsetY * translateFactor) + 'px)';

                image.style.transform = transformValue;
            });

            container.addEventListener('mouseleave', function () {
                image.style.transform = 'scale(1)';
            });
        });
    </script>
    <script>
        function changeProductImage(imageSrc) {
            document.getElementById('main-product-image').src = "/assets/images/productImg/sharpedImg/" + imageSrc;
        }
    </script>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        async function addToCart() {
            try {
                const productId = document.getElementById('productId').value
                const quantity = document.getElementById('quantity').value
                const data = {
                    productId: productId,
                    quantity: quantity
                }

                const response = await axios.post('/addToCart',data)

                if (response.data.success) {
                    Swal.fire({
                        title: "Success",
                        text: "Product Added to Cart",
                        icon: "Success",
                        showCancelButton: true,
                        confirmButtonText: "Go to Cart",
                        cancelButtonText: "Continue Shopping",
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = '/cart';
                        } else if (result.dismiss === Swal.DismissReason.cancel) {
                            window.location.href = '/shop';
                        }
                    });
                } else {
                    Swal.fire({
                        title: "Error adding to cart",
                        text: "Please login to continue",
                        icon: "error",
                        showCancelButton: true,
                        confirmButtonText: "Login",
                        cancelButtonText: "Cancel",
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.href = '/login';
                        } else if (result.dismiss === Swal.DismissReason.cancel) {
                            // Handle cancel action if needed
                        }
                    });
                }
            } catch (error) {
                console.log(error);
            }
        } 
    </script>

<script>
    function addToWishlist(productId) {
        const data = { productId };
        fetch('/addToWishlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                // Check if response is HTML error page
                if (response.status >= 400 && response.status < 600) {
                    // Handle HTML error response
                    throw new Error('Server Error: ' + response.status);
                } else {
                    throw new Error('Network response was not ok');
                }
            }
        })
        .then(data => {
            if (data.loginRequired) {
                // Handle login required scenario
                Swal.fire({
                    icon: "warning",
                    title: 'Please Log In',
                    text: 'You need to log in before adding items to your wishlist.',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#3085d6'
                }).then((response) => {
                    if (response.isConfirmed) {
                        // Redirect user to the login page
                        window.location.href = '/login';
                    }
                });
            } else if (data.used) {
                // Handle item already in wishlist scenario
                Swal.fire({
                    icon: "warning",
                    title: 'Item Already in Wishlist',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#3085d6'
                });
            } else {
                // Handle successful addition to wishlist scenario
                Swal.fire({
                    icon: "success",
                    title: 'Item Added to Wishlist',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#3085d6'
                }).then((response) => {
                    if (response.isConfirmed) {
                        location.reload();
                    }
                });
            }
        })
        .catch(error => {
            console.error('There was an error!', error);
            // Handle other errors
            Swal.fire({
                icon: "error",
                title: 'Error',
                text: 'There was an error adding the item to the wishlist. Please try again later.',
                confirmButtonText: 'OK',
                confirmButtonColor: '#3085d6'
            });
        });
    }
</script>




    <%- include('../layout/user/footer.ejs') %>